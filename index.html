<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AI ìºë¦­í„° í¬ì¦ˆ ìƒì„±ê¸° v10.9 â€” ì  ëˆˆ + í”„ë¡œ íˆ¬ì‹œ</title>
<style>
  body{margin:0;background:#fff;color:#222;font-family:"Noto Sans KR",system-ui,sans-serif;text-align:center}
  canvas{width:512px;height:512px;background:transparent;border:1px solid #ddd;border-radius:12px;margin:12px}
  .controls{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin:10px}
  label{font-size:13px}
  select,input[type=range]{margin:4px;padding:4px;border-radius:6px}
  button{padding:8px 12px;border-radius:8px;border:none;background:#06b6d4;color:#fff;font-weight:700;cursor:pointer}
</style>
</head>
<body>
<h1>ğŸ§ AI ìºë¦­í„° í¬ì¦ˆ ìƒì„±ê¸° v10.9</h1>
<div class="controls">
  <label>ë“±ì‹ 
    <select id="ratio">
      <option value="1">1ë“±ì‹ </option>
      <option value="1.5">1.5ë“±ì‹ </option>
      <option value="2" selected>2ë“±ì‹ </option>
      <option value="2.5">2.5ë“±ì‹ </option>
      <option value="3">3ë“±ì‹ </option>
    </select>
  </label>
  <label>íˆ¬ì‹œ ê°•ë„
    <input type="range" id="persp" min="0.1" max="0.6" step="0.05" value="0.35">
  </label>
  <label>ì‹œì 
    <select id="view">
      <option value="front">ì •ë©´</option>
      <option value="top">ìœ„</option>
      <option value="bottom">ì•„ë˜</option>
      <option value="left">ì™¼ìª½</option>
      <option value="right">ì˜¤ë¥¸ìª½</option>
    </select>
  </label>
  <label>ì™¼íŒ” ê°ë„<input type="range" id="lArm" min="-180" max="180" value="-20"></label>
  <label>ì˜¤ë¥¸íŒ” ê°ë„<input type="range" id="rArm" min="-180" max="180" value="20"></label>
  <label>ì™¼ë‹¤ë¦¬ ê°ë„<input type="range" id="lLeg" min="-180" max="180" value="10"></label>
  <label>ì˜¤ë¥¸ë‹¤ë¦¬ ê°ë„<input type="range" id="rLeg" min="-180" max="180" value="-10"></label>
  <label>ë¨¸ë¦¬ ê°ë„<input type="range" id="headTilt" min="-180" max="180" value="0"></label>
  <label>í‘œì • ê°ë„<input type="range" id="faceAngle" min="-180" max="180" value="0"></label>
  <label>ëª¸ ê°ë„<input type="range" id="bodyTilt" min="-180" max="180" value="0"></label>
  <label>ì„  ë‘ê»˜<input type="range" id="lw" min="6" max="24" value="12"></label>
  <label>ì†ë„<input type="range" id="speed" min="0.2" max="3" step="0.1" value="1"></label>
  <label>ì „ì²´ ìŠ¤ì¼€ì¼<input type="range" id="gScale" min="0.6" max="1.0" step="0.01" value="0.85"></label>
  <label>ìë™ ë§ì¶¤ <input type="checkbox" id="autoFit"></label>
</div>
<div>
  <button id=\"rotateBtn\">360Â° íšŒì „ â–¶</button>
  <button id="saveBtn">PNG ì €ì¥</button>
</div>
<canvas id="cv" width="1024" height="1024"></canvas>

<script>
const cv=document.getElementById('cv'), ctx=cv.getContext('2d');
const $=id=>document.getElementById(id);
const TAU=Math.PI*2; const deg=d=>d*Math.PI/180;

// --- ì •í™•í•œ ë“±ì‹  ë¹„ìœ¨ ê³„ì‚° ---
// ì´í‚¤ = ë“±ì‹ ê°’ Ã— ë¨¸ë¦¬ì§€ë¦„ ì„ í•­ìƒ ë§Œì¡± (ìŠ¤ì¼€ì¼ì€ ë³„ë„ë¡œ ê³±í•´ì§)
function computeProportions(headsTall){
  const desiredTotal = 600;                 // ê¸°ì¤€ ì´í‚¤(px) â€” ìŠ¤ì¼€ì¼ë¡œ ì¶•ì†Œ/í™•ëŒ€
  const headR = desiredTotal / (2*headsTall);// ë¨¸ë¦¬ ë°˜ì§€ë¦„
  const headD = headR*2;                     // ë¨¸ë¦¬ì§€ë¦„
  const total = headsTall * headD;           // ì‹¤ì œ ì´í‚¤(ê²€ì¦)
  const bodyH = Math.max(total - headD, 0);  // ëª¸í†µ ë†’ì´ (1ë“±ì‹ ì´ë©´ 0)
  return {headR, headD, bodyH, total};
}

function getPerspective(view, p){
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  p = clamp(p, 0.1, 0.8);
  let shearY=0, scaleY=1, y=0;
  let headScale=1, armScaleL=1, armScaleR=1, legScaleL=1, legScaleR=1;
  if(view==='front'){
    // neutral
  } else if(view==='top'){
    shearY = -0.9*p;                // ìœ„ì—ì„œ ë‚´ë ¤ë‹¤ë³´ëŠ” ê¸°ìš¸ê¸°
    scaleY = 1 - 0.45*p;            // ì„¸ë¡œ ë‹¨ì¶• (foreshortening)
    y      = 120;                    // ì‚´ì§ ì•„ë˜ë¡œ ë‚´ë¦¼
    headScale = 1 + 0.14*p;         // ë¨¸ë¦¬ ì»¤ì§(ê°€ê¹Œì›€)
    armScaleL = armScaleR = 1.0;    // íŒ”ì€ ê±°ì˜ ë™ì¼
    legScaleL = legScaleR = 0.85;   // ë‹¤ë¦¬ ì§§ì•„ë³´ì„
  } else if(view==='bottom'){
    shearY = 1.2*p;                 // ì•„ë˜ì—ì„œ ì˜¬ë ¤ë‹¤ë³´ëŠ” ê¸°ìš¸ê¸°
    scaleY = 1 + 0.55*p;            // ì„¸ë¡œ í™•ì¥ (ê³¼ì¥)
    y      = -180;                   // ìœ„ë¡œ ì˜¬ë¦¼(í”„ë ˆì„ ì•ˆì°©)
    headScale = Math.max(0.8, 1 - 0.18*p); // ë¨¸ë¦¬ ì‘ì•„ì§(ì›ê·¼)
    armScaleL = armScaleR = 1 + 0.12*p;
    legScaleL = legScaleR = 1 + 0.38*p;    // ë‹¤ë¦¬ ê¸¸ì–´ì§
  } else if(view==='left'){
    shearY = 0.15*p;                // ì•½ê°„ì˜ ìƒí•˜ ê¸°ìš¸ê¸°
    headScale = 1;
    armScaleL = 1 + 0.18*p;         // ì™¼ìª½(ê°€ê¹Œì›€) íŒ”
    armScaleR = 1 - 0.12*p;         // ì˜¤ë¥¸ìª½(ë©€ì–´ì§) íŒ”
    legScaleL = 1 + 0.22*p;         // ì™¼ìª½ ë‹¤ë¦¬
    legScaleR = 1 - 0.15*p;         // ì˜¤ë¥¸ìª½ ë‹¤ë¦¬
  } else if(view==='right'){
    shearY = -0.15*p;
    headScale = 1;
    armScaleL = 1 - 0.12*p;         // ì™¼ìª½(ë©€ì–´ì§)
    armScaleR = 1 + 0.18*p;         // ì˜¤ë¥¸ìª½(ê°€ê¹Œì›€)
    legScaleL = 1 - 0.15*p;
    legScaleR = 1 + 0.22*p;
  }
  return {shearY, scaleY, y, headScale, armScaleL, armScaleR, legScaleL, legScaleR};
}

function drawFaceSmileDots(r){
  // ğŸ˜Š ì  ëˆˆ + ë¯¸ì†Œ (ëˆˆì€ ì±„ì›€, ì…ì€ ì„ )
  ctx.save();
  ctx.beginPath();
  // ëˆˆ: ì±„ìš´ ì›
  ctx.moveTo(0,0); // Safari fill bug guard
  ctx.fillStyle = '#000';
  for(const s of [-1,1]){
    ctx.beginPath();
    ctx.arc(s*r*0.18, -r*0.06, r*0.06, 0, Math.PI*2);
    ctx.fill();
  }
  // ì…: ë¶€ë“œëŸ¬ìš´ ì•„ì¹˜(ì„ )
  ctx.beginPath();
  ctx.moveTo(-r*0.24, r*0.26);
  ctx.quadraticCurveTo(0, r*0.38, r*0.24, r*0.26);
  ctx.stroke();
  ctx.restore();
}{
  // ğŸ˜Š ê¸°ë³¸ ì›ƒëŠ” í‘œì •: ë°˜ë‹¬ ëˆˆ + ë¯¸ì†Œ ê³¡ì„ 
  ctx.beginPath();
  // ëˆˆ (ë°˜ë‹¬)
  for(const s of[-1,1]){
    ctx.arc(s*r*0.22, -r*0.10, r*0.08, Math.PI, 0, true);
  }
  // ì… (ë¶€ë“œëŸ¬ìš´ ì•„ì¹˜)
  ctx.moveTo(-r*0.22, r*0.26);
  ctx.quadraticCurveTo(0, r*0.38, r*0.22, r*0.26);
  ctx.stroke();
}

function getAutoScale(view,p){
  // ê²½í—˜ì  ì˜¤í†  ìŠ¤ì¼€ì¼: íˆ¬ì‹œ ê°•ë„ì™€ ì‹œì ë³„ ì—¬ë°± í™•ë³´
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  let base=0.9;
  if(view==='front') return clamp(base-0.02,0.6,0.95);
  if(view==='left' || view==='right') return clamp(base - (0.18 + 0.5*(p-0.1)),0.6,0.9);
  if(view==='top' || view==='bottom') return clamp(base - (0.22 + 0.7*(p-0.1)),0.6,0.88);
  return clamp(0.85,0.6,0.95);
}

function drawCharacter(){
  const headsTall=parseFloat($('ratio').value);
  const {headR, headD, bodyH}=computeProportions(headsTall);
  const lw=parseFloat($('lw').value);
  const p=parseFloat($('persp').value);
  const view=$('view').value;
  const lArm=parseFloat($('lArm').value); const rArm=parseFloat($('rArm').value);
  const lLeg=parseFloat($('lLeg').value); const rLeg=parseFloat($('rLeg').value);
  const headTilt=parseFloat($('headTilt').value); const bodyTilt=parseFloat($('bodyTilt').value);
  const faceAngle=parseFloat($('faceAngle').value);
  const autoFitEl=$('autoFit');
  const userScale=parseFloat($('gScale').value)||0.85;
  let s=(autoFitEl && autoFitEl.checked) ? getAutoScale(view,p) : userScale;

  ctx.clearRect(0,0,cv.width,cv.height);
  ctx.save();
  ctx.translate(512, 620);
  ctx.scale(s, s);
  ctx.lineWidth=lw; ctx.strokeStyle='#000'; ctx.lineCap='round'; ctx.lineJoin='round';

  // ì „ë¬¸ ì›ê·¼ íŒŒë¼ë¯¸í„° ê³„ì‚° + ì ìš©
  const persp = getPerspective(view, p);
  ctx.transform(1, persp.shearY, 0, persp.scaleY, 0, persp.y);
  ctx.rotate(deg(bodyTilt));

  // ===== ëª¸í†µ =====
  const hasBody = bodyH > 0.0001;
  const bodyRy = hasBody ? bodyH/2 : 0;
  const bodyRx = hasBody ? headR*0.9 : 0;
  if(hasBody){ ctx.beginPath(); ctx.ellipse(0, 0, bodyRx, bodyRy, 0, 0, Math.PI*2); ctx.stroke(); }

  // ===== íŒ”ë‹¤ë¦¬ ê¸¸ì´ (ë“±ì‹  + ì›ê·¼ ë°˜ì˜) =====
  let limbBase;
  if(headsTall<=1){      limbBase=headR*0.70; }
  else if(headsTall<=1.5){limbBase=headR*0.95; }
  else if(headsTall<=2){  limbBase=headR*1.25; }
  else if(headsTall<=2.5){limbBase=headR*1.50; }
  else {                  limbBase=headR*1.70; }

  function limb(x,y,len,ang){ ctx.save(); ctx.translate(x,y); ctx.rotate(deg(ang)); ctx.beginPath(); ctx.moveTo(0,0); ctx.quadraticCurveTo(0,len*0.35,0,len); ctx.stroke(); ctx.restore(); }

  const armAnchorY = hasBody ? -bodyRy*0.35 : -headR*0.05;
  const armAnchorX = hasBody ? bodyRx*1.05 : headR*0.9;
  const legAnchorY = hasBody ? bodyRy*0.95 : headR*0.92;
  const legAnchorX = hasBody ? bodyRx*0.5  : headR*0.45;

  limb(-armAnchorX, armAnchorY, limbBase*0.9*persp.armScaleL, lArm);
  limb( armAnchorX, armAnchorY, limbBase*0.9*persp.armScaleR, rArm);
  limb(-legAnchorX, legAnchorY, limbBase*persp.legScaleL, lLeg);
  limb( legAnchorX, legAnchorY, limbBase*persp.legScaleR, rLeg);

  // ===== ë¨¸ë¦¬ (ëª© ê°„ê²© ì—†ìŒ) =====
  const headY = hasBody ? -bodyRy - headR : -headR*0.02;
  const rHead = headR * persp.headScale; // ì›ê·¼ì— ë”°ë¥¸ ë¨¸ë¦¬ í¬ê¸° ë³´ì •
  ctx.save(); ctx.translate(0, headY); ctx.rotate(deg(headTilt));
  ctx.beginPath(); ctx.arc(0,0, rHead, 0, Math.PI*2); ctx.stroke();
  ctx.save(); ctx.rotate(deg(faceAngle)); drawFaceSmileDots(rHead); ctx.restore();
  ctx.restore();

  ctx.restore();
}

['ratio','persp','view','lArm','rArm','lLeg','rLeg','headTilt','bodyTilt','lw','gScale','faceAngle','autoFit'].forEach(id=>$(id).addEventListener('input',drawCharacter));

// gScale ë¹„í™œì„±í™” í† ê¸€
const __auto=$('autoFit'), __gs=$('gScale');
if(__auto && __gs){ const sync=()=>{ __gs.disabled = __auto.checked; }; __auto.addEventListener('change',()=>{ sync(); drawCharacter(); }); sync(); }

// 360Â° íšŒì „ ì• ë‹ˆë©”ì´ì…˜ (ì¥ë©´ íšŒì „)
let running=false, angle=0, animID; $('rotateBtn').onclick=()=>{
  if(running){ cancelAnimationFrame(animID); running=false; $('rotateBtn').textContent='360Â° íšŒì „ â–¶'; return; }
  running=true; $('rotateBtn').textContent='ì •ì§€ â¸';
  function spin(){ angle=(angle+parseFloat($('speed').value))%360; ctx.save(); ctx.clearRect(0,0,cv.width,cv.height); ctx.translate(512,512); ctx.rotate(deg(angle)); ctx.translate(-512,-512); drawCharacter(); ctx.restore(); animID=requestAnimationFrame(spin); }
  spin();
};

// PNG ì €ì¥
$('saveBtn').onclick=()=>{ drawCharacter(); const a=document.createElement('a'); a.download='character_'+Math.floor(Math.random()*9999)+'.png'; a.href=cv.toDataURL('image/png'); a.click(); };

// ì´ˆê¸° ë Œë”
drawCharacter();
</script>
</body>
</html>
